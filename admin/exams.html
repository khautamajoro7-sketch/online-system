<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Exams</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #09ebf3c7;
            padding: 20px;
        }
        .container {
            background: rgba(212, 241, 48, 0.808);
            padding: 30px;
            border-radius: 8px;
            max-width: 900px;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(181, 240, 44, 0.842);
        }
        h1 {
            text-align: center;
        }
        .exam-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .exam-list th, .exam-list td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #6aee36;
        }
        .exam-list th {
            background-color: #96ee31;
            color: rgb(121, 42, 42);
        }
        button {
            padding: 5px 10px;
            margin: 5px;
            border-radius: 4px;
            border: 1px solid #26f514fd;
            cursor: pointer;
        }
        .edit-btn {
            background-color: rgb(115, 255, 0);
            color: rgb(4, 14, 2);
        }
        .delete-btn {
            background-color: red;
            color: rgb(7, 1, 1);
        }
        .question-btn {
            background-color: #0066cc;
            color: rgb(7, 1, 1);
        }
        .msg {
            color: green;
            text-align: center;
        }
        .error {
            color: red;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Manage Exams</h1>
    
    <p class="msg" id="successMsg"></p>
    <p class="error" id="errorMsg"></p>

    <table class="exam-list">
        <thead>
            <tr>
                <th>Exam Title</th>
                <th>Description</th>
                <th>Total Marks</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="examList"></tbody>
    </table>
</div>

<script>
// Check if the user is an admin
const role = sessionStorage.getItem('role');
if (role !== 'admin') {
    window.location.href = 'index.html';  // Redirect to login if not admin
}

// Load all exams from localStorage
const exams = JSON.parse(localStorage.getItem('exams')) || [];

// Function to generate the list of exams
function loadExams() {
    const examList = document.getElementById('examList');
    examList.innerHTML = '';  // Clear previous list

    if (exams.length === 0) {
        examList.innerHTML = "<tr><td colspan='4' class='error'>No exams found.</td></tr>";
        return;
    }

    exams.forEach((exam, index) => {
        const row = document.createElement('tr');

        row.innerHTML = `
            <td>${exam.title}</td>
            <td>${exam.description}</td>
            <td>${exam.totalMarks}</td>
            <td>
                <button class="edit-btn" onclick="editExam(${index})">Edit Exam</button>
                <button class="question-btn" onclick="manageQuestions(${index})">Manage Questions</button>
                <button class="delete-btn" onclick="deleteExam(${index})">Delete Exam</button>
            </td>
        `;
        examList.appendChild(row);
    });
}

// Edit Exam function
function editExam(index) {
    const exam = exams[index];
    
    const newTitle = prompt("Enter new title for the exam", exam.title);
    const newDescription = prompt("Enter new description for the exam", exam.description);
    const newTotalMarks = prompt("Enter new total marks", exam.totalMarks);
    const newDuration = prompt("Enter new duration (in minutes)", exam.duration);

    if (newTitle && newDescription && newTotalMarks && newDuration) {
        exams[index] = { ...exam, title: newTitle, description: newDescription, totalMarks: newTotalMarks, duration: newDuration };
        localStorage.setItem('exams', JSON.stringify(exams));
        document.getElementById('successMsg').textContent = 'Exam updated successfully!';
        document.getElementById('errorMsg').textContent = '';
        loadExams();
    } else {
        document.getElementById('errorMsg').textContent = 'All fields are required to update the exam.';
    }
}

// Manage Questions function
function manageQuestions(index) {
    const exam = exams[index];
    sessionStorage.setItem('examIndex', index);  // Save exam index to sessionStorage

    // Redirect to the exam questions management page
    window.location.href = 'manage_questions.html';
}

// Delete Exam function
function deleteExam(index) {
    const confirmation = confirm("Are you sure you want to delete this exam?");
    if (confirmation) {
        exams.splice(index, 1); // Remove the exam from the array
        localStorage.setItem('exams', JSON.stringify(exams));
        document.getElementById('successMsg').textContent = 'Exam deleted successfully!';
        document.getElementById('errorMsg').textContent = '';
        loadExams();  // Reload the exam list
    }
}

// Load exams on page load
window.onload = loadExams;
</script>

</body>
</html>
