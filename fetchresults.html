<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Results – Online Exam System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #22e0d1;
            padding: 20px;
        }
        .container {
            background: rgb(100, 96, 96);
            padding: 30px;
            border-radius: 8px;
            max-width: 900px;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .error {
            text-align: center;
            color: red;
        }
        .exam-result {
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        .question-result {
            padding: 10px;
            margin-top: 10px;
            background: #ffffff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        h1, h2 {
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Your Exam Results</h1>

    <label>Select Exam:</label>
    <select id="examSelect"></select>

    <div id="resultsSection"></div>
</div>

<script>
// -----------------------------
// REQUIRE LOGIN
// -----------------------------
const username = sessionStorage.getItem('username');
if (!username) {
    alert("You must be logged in to view results.");
    window.location.href = "login.html";
}

// -----------------------------
// LOAD DATA
// -----------------------------
const exams = JSON.parse(localStorage.getItem('exams')) || [];
const graded = JSON.parse(localStorage.getItem('graded')) || [];

// Populate exam dropdown
const examSelect = document.getElementById('examSelect');
exams.forEach(exam => {
    const opt = document.createElement('option');
    opt.value = exam.id;
    opt.textContent = exam.title;
    examSelect.appendChild(opt);
});

// Auto-load first exam
window.onload = function() {
    if (exams.length > 0) {
        examSelect.value = exams[0].id;
        loadResults();
    }
};

// When exam changes → reload results
examSelect.addEventListener('change', loadResults);

// -----------------------------
// LOAD RESULTS FOR LOGGED USER
// -----------------------------
function loadResults() {
    const examId = parseInt(examSelect.value);
    const container = document.getElementById('resultsSection');

    container.innerHTML = "<h2>Results</h2>";

    const exam = exams.find(e => e.id === examId);

    // Find graded result for this student + exam
    const result = graded.find(r => r.examId === examId && r.student === username);

    if (!result) {
        container.innerHTML += `<p class="error">No graded result found for exam: <strong>${exam.title}</strong></p>`;
        return;
    }

    // Build display
    const div = document.createElement('div');
    div.classList.add('exam-result');

    div.innerHTML = `
        <h3>${exam.title}</h3>
        <p><strong>Total Marks:</strong> ${result.totalMarks}</p>
        <h4>Breakdown:</h4>
    `;

    result.breakdown.forEach((item, i) => {
        const qDiv = document.createElement('div');
        qDiv.classList.add('question-result');

        qDiv.innerHTML = `
            <p><strong>Q${i + 1}:</strong> ${item.question}</p>
            <p><strong>Marks Awarded:</strong> ${item.marks}</p>
        `;

        div.appendChild(qDiv);
    });

    container.appendChild(div);
}
</script>

</body>
</html>
